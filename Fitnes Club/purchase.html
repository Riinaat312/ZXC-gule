<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Завершение покупки - Фитнес-клуб Здоровая Жизнь</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <style>
    .hero-section {
      background-image: url('img/pototo.png');
      background-size: cover;
      background-position: center;
      position: relative;
    }
    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1;
    }
    .hero-content {
      position: relative;
      z-index: 2;
    }
    .tab-active {
      border-bottom: 3px solid #10b981;
      color: #10b981;
    }
    .purchase-section {
      display: none;
    }
    .active-section {
      display: block;
    }
    .time-slot {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .time-slot:hover {
      background-color: #f0fdf4;
    }
    .time-slot.selected {
      background-color: #dcfce7;
      border-color: #10b981;
    }
    
    /* Enhanced styling for the purchase page */
    .pricing-toggle {
      background-color: #e5e7eb;
      border-radius: 999px;
      position: relative;
      padding: 4px;
      width: 220px;
      margin: 0 auto;
    }
    .toggle-option {
      padding: 8px 16px;
      border-radius: 999px;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      z-index: 1;
      transition: color 0.3s ease;
    }
    .toggle-slider {
      position: absolute;
      top: 4px;
      left: 4px;
      width: 108px;
      height: calc(100% - 8px);
      background-color: white;
      border-radius: 999px;
      transition: transform 0.3s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .toggle-slider.annual {
      transform: translateX(104px);
    }
    
    /* Added payment method styles */
    .payment-method {
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .payment-method:hover {
      border-color: #10b981;
    }
    .payment-method.selected {
      border-color: #10b981;
      background-color: #f0fdf4;
    }
    
    /* Enhanced summary section */
    .order-summary {
      background-color: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    
    /* Success animation */
    @keyframes checkmark {
      0% { transform: scale(0); opacity: 0; }
      25% { transform: scale(1.1); opacity: 1; }
      50% { transform: scale(0.9); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    .success-checkmark {
      animation: checkmark 0.5s ease-in-out forwards;
    }
    
    /* Cart badge */
    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: #ef4444;
      color: white;
      border-radius: 999px;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

  <script>AOS.init();</script>

  <!-- Шапка с навигационной панелью -->
  <header class="bg-green-600 text-white p-6 shadow-md" data-aos="fade-down">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-3xl font-bold">
        <a href="main.html">Здоровая Жизнь</a>
      </h1>
      <nav class="hidden md:flex space-x-4 text-lg">
        <a href="main.html" class="hover:underline">Главная</a>
        <a href="main.html#about" class="hover:underline">О нас</a>
        <a href="page1.html" class="hover:underline">Расписание</a>
        <a href="page2.html" class="hover:underline">Тренеры</a>
        <a href="nutritionPlans.html" class="hover:underline">Питание</a>
        <a href="pricing.html" class="hover:underline">Цены</a>
        <a href="login.html" class="bg-white text-green-600 border border-white px-4 py-2 rounded-full hover:bg-gray-100 transition mr-2" id="loginBtn">Вход</a>
        <a href="register.html" class="bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-700 transition" id="registerBtn">Регистрация</a>
      </nav>
      
      <!-- Кнопка мобильного меню -->
      <button id="mobileMenuBtn" class="md:hidden flex items-center text-white">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
    
    <!-- Мобильное меню (скрыто по умолчанию) -->
    <div id="mobileMenu" class="md:hidden hidden bg-green-700 mt-4 rounded-lg p-4">
      <nav class="flex flex-col space-y-3">
        <a href="main.html" class="hover:bg-green-600 px-3 py-2 rounded">Главная</a>
        <a href="main.html#about" class="hover:bg-green-600 px-3 py-2 rounded">О нас</a>
        <a href="page1.html" class="hover:bg-green-600 px-3 py-2 rounded">Расписание</a>
        <a href="page2.html" class="hover:bg-green-600 px-3 py-2 rounded">Тренеры</a>
        <a href="nutritionPlans.html" class="hover:bg-green-600 px-3 py-2 rounded">Питание</a>
        <a href="pricing.html" class="hover:bg-green-600 px-3 py-2 rounded">Цены</a>
        <div class="flex space-x-2 mt-2">
          <a href="login.html" class="bg-white text-green-600 px-4 py-2 rounded-lg flex-1 text-center" id="mobileLoginBtn">Вход</a>
          <a href="register.html" class="bg-green-500 text-white px-4 py-2 rounded-lg flex-1 text-center" id="mobileRegisterBtn">Регистрация</a>
        </div>
      </nav>
    </div>
  </header>

  <!-- Баннер с хлебными крошками -->
  <section class="hero-section py-16 text-center" data-aos="zoom-in">
    <div class="hero-content">
      <div class="text-sm text-white/80 mb-2">
        <a href="main.html" class="hover:text-white">Главная</a> / 
        <a href="pricing.html" class="hover:text-white">Цены</a> / 
        <span class="text-white">Оформление</span>
      </div>
      <h2 class="text-4xl font-bold text-white mb-2">Завершение покупки</h2>
      <p class="text-xl text-white">Вы в одном шаге от начала вашего фитнес-путешествия</p>
    </div>
  </section>

  <!-- Вкладки покупки - с иконками -->
  <div class="container mx-auto px-4 -mt-8">
    <div class="bg-white rounded-t-xl shadow-md px-6 pt-3 flex border-b" id="purchaseTabs">
      <button class="px-4 py-3 font-semibold tab-button tab-active flex items-center" data-tab="membership">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        Абонемент
      </button>
      <button class="px-4 py-3 font-semibold tab-button flex items-center" data-tab="classes">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        Групповые занятия
      </button>
      <button class="px-4 py-3 font-semibold tab-button flex items-center" data-tab="services">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
        </svg>
        Персональные услуги
      </button>
      <div class="ml-auto relative">
        <button id="cartButton" class="px-4 py-2 bg-green-600 text-white rounded-full flex items-center">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
          </svg>
          Корзина
          <span id="cartBadge" class="cart-badge hidden">0</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Секция покупки абонемента -->
  <section id="membership-section" class="purchase-section active-section py-8 container mx-auto px-4">
    <div class="max-w-5xl mx-auto bg-white rounded-b-xl shadow-md p-8">
      <h3 class="text-2xl font-bold text-green-600 mb-6" id="membershipTitle">Выберите ваш абонемент</h3>
      
      <!-- Уведомление для пользователей без абонемента -->
      <div id="upgrade-notice" class="bg-green-50 border-l-4 border-green-600 p-4 mb-6 hidden">
        <div class="flex">
          <div class="flex-shrink-0">
            <svg class="h-5 w-5 text-green-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
          </div>
          <div class="ml-3">
            <p class="text-sm text-green-700">
              Вы переходите с бесплатного аккаунта. Этот выбор активирует премиум-функции для вашей учетной записи.
            </p>
          </div>
        </div>
      </div>
      
      <!-- Переключатель биллинга -->
      <div class="mb-8">
        <div class="pricing-toggle mx-auto">
          <div class="toggle-slider" id="toggleSlider"></div>
          <div class="flex">
            <div class="toggle-option monthly-option flex-1 text-green-600" id="monthlyOption">Ежемесячно</div>
            <div class="toggle-option annual-option flex-1 text-gray-600" id="annualOption">Ежегодно <span class="px-2 py-0.5 ml-1 bg-green-100 text-green-800 text-xs rounded-full">Экономия 20%</span></div>
          </div>
        </div>
      </div>
      
      <!-- Варианты абонементов -->
      <div class="grid md:grid-cols-3 gap-6 mb-8">
        <!-- Базовый тариф -->
        <div class="membership-option border rounded-xl p-4 cursor-pointer hover:border-blue-500 hover:shadow-md transition" data-plan="basic">
          <div class="flex justify-between items-center mb-4">
            <h4 class="text-xl font-bold text-blue-600">Базовый</h4>
            <span class="rounded-full w-6 h-6 border-2 border-gray-300 membership-radio"></span>
          </div>
          <div class="monthly-prices">
            <div class="text-2xl font-bold">2900<span class="text-base font-normal text-gray-500">₽/мес</span></div>
          </div>
          <div class="annual-prices hidden">
            <div class="text-2xl font-bold">2300<span class="text-base font-normal text-gray-500">₽/мес</span></div>
            <div class="text-sm text-gray-500">27600₽ в год</div>
          </div>
          <div class="mt-4 text-gray-600 text-sm">
            <ul class="space-y-2">
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Доступ в стандартные часы</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Доступ ко всему оборудованию</span>
              </li>
            </ul>
          </div>
        </div>
        
        <!-- Стандартный тариф -->
        <div class="membership-option border-2 border-green-500 rounded-xl p-4 cursor-pointer shadow-md relative" data-plan="standard">
          <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-3 py-1 rounded-full text-xs font-bold">РЕКОМЕНДУЕМ</div>
          <div class="flex justify-between items-center mb-4">
            <h4 class="text-xl font-bold text-green-600">Стандарт</h4>
            <span class="rounded-full w-6 h-6 border-2 border-green-500 bg-green-500 membership-radio flex items-center justify-center">
              <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </span>
          </div>
          <div class="monthly-prices">
            <div class="text-2xl font-bold">4900<span class="text-base font-normal text-gray-500">₽/мес</span></div>
          </div>
          <div class="annual-prices hidden">
            <div class="text-2xl font-bold">3900<span class="text-base font-normal text-gray-500">₽/мес</span></div>
            <div class="text-sm text-gray-500">46800₽ в год</div>
          </div>
          <div class="mt-4 text-gray-600 text-sm">
            <ul class="space-y-2">
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Доступ в расширенные часы</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>2 групповых занятия в неделю</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>1 персональная тренировка в месяц</span>
              </li>
            </ul>
          </div>
        </div>
        
        <!-- Премиум тариф -->
        <div class="membership-option border rounded-xl p-4 cursor-pointer hover:border-purple-500 hover:shadow-md transition" data-plan="premium">
          <div class="flex justify-between items-center mb-4">
            <h4 class="text-xl font-bold text-purple-600">Премиум</h4>
            <span class="rounded-full w-6 h-6 border-2 border-gray-300 membership-radio"></span>
          </div>
          <div class="monthly-prices">
            <div class="text-2xl font-bold">7900<span class="text-base font-normal text-gray-500">₽/мес</span></div>
          </div>
          <div class="annual-prices hidden">
            <div class="text-2xl font-bold">6300<span class="text-base font-normal text-gray-500">₽/мес</span></div>
            <div class="text-sm text-gray-500">75600₽ в год</div>
          </div>
          <div class="mt-4 text-gray-600 text-sm">
            <ul class="space-y-2">
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Доступ 24/7</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Безлимитные групповые занятия</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>2 персональные тренировки в месяц</span>
              </li>
              <li class="flex items-start">
                <svg class="w-5 h-5 text-green-500 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span>Консультация по питанию</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
      
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Левая колонка - Форма оформления -->
        <div>
          <h4 class="text-xl font-bold mb-6 pb-2 border-b">Ваши данные</h4>
          <form id="membershipForm">
            <div class="mb-4">
              <label for="name" class="block text-gray-700 mb-2">ФИО*</label>
              <input type="text" id="name" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <div class="mb-4">
              <label for="email" class="block text-gray-700 mb-2">Электронная почта*</label>
              <input type="email" id="email" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <div class="mb-4">
              <label for="phone" class="block text-gray-700 mb-2">Номер телефона*</label>
              <input type="tel" id="phone" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            
            <h4 class="text-xl font-bold mt-8 mb-4 pb-2 border-b">Способ оплаты</h4>
            
            <div class="grid grid-cols-3 gap-3 mb-6">
              <div class="payment-method selected" data-method="credit">
                <div class="flex justify-center">
                  <img src="https://cdn-icons-png.flaticon.com/512/179/179431.png" alt="Кредитная карта" class="h-8">
                </div>
                <div class="text-center text-sm mt-2">Кредитная карта</div>
              </div>
              <div class="payment-method" data-method="paypal">
                <div class="flex justify-center">
                  <img src="https://cdn-icons-png.flaticon.com/512/174/174861.png" alt="PayPal" class="h-8">
                </div>
                <div class="text-center text-sm mt-2">PayPal</div>
              </div>
              <div class="payment-method" data-method="apple">
                <div class="flex justify-center">
                  <img src="https://cdn-icons-png.flaticon.com/512/888/888871.png" alt="Apple Pay" class="h-8">
                </div>
                <div class="text-center text-sm mt-2">Apple Pay</div>
              </div>
            </div>
            
            <div id="creditCardForm">
              <div class="mb-4">
                <label for="cardNumber" class="block text-gray-700 mb-2">Номер карты*</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div class="mb-4">
                  <label for="expiryDate" class="block text-gray-700 mb-2">Срок действия*</label>
                  <input type="text" id="expiryDate" placeholder="ММ/ГГ" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                <div class="mb-4">
                  <label for="cvv" class="block text-gray-700 mb-2">CVV*</label>
                  <input type="text" id="cvv" placeholder="123" required class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
              </div>
            </div>
            
            <div class="mt-6">
              <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition">Завершить покупку</button>
            </div>
          </form>
        </div>
        
        <!-- Правая колонка - Сводка заказа -->
        <div>
          <h4 class="text-xl font-bold mb-6 pb-2 border-b">Сводка заказа</h4>
          <div class="order-summary p-6">
            <div class="flex justify-between items-center mb-4 pb-4 border-b">
              <span class="font-medium" id="summaryPlanName">Стандартный абонемент</span>
              <span class="font-bold" id="summaryPlanPrice">4900₽/месяц</span>
            </div>
            
            <div class="mb-4 pb-4 border-b">
              <div class="flex justify-between mb-2">
                <span>Подытог</span>
                <span id="summarySubtotal">4900₽</span>
              </div>
              <div class="flex justify-between text-green-700">
                <span>Скидка</span>
                <span id="summaryDiscount">0₽</span>
              </div>
            </div>
            
            <div class="flex justify-between font-bold text-lg">
              <span>Итого</span>
              <span id="summaryTotal">4900₽</span>
            </div>
            
            <div class="mt-6 text-sm text-gray-600">
              <p>Завершая покупку, вы соглашаетесь с нашими <a href="terms.html" class="text-green-600 hover:underline">Условиями обслуживания</a> и <a href="privacy.html" class="text-green-600 hover:underline">Политикой конфиденциальности</a>.</p>
            </div>
          </div>
          
          <div class="mt-6 bg-green-50 p-4 rounded-lg">
            <h5 class="font-bold flex items-center">
              <svg class="w-5 h-5 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              Нужна помощь?
            </h5>
            <p class="mt-2 text-sm">Свяжитесь с нашей службой поддержки по адресу <a href="mailto:support@healthylife.com" class="text-green-600 hover:underline">support@healthylife.com</a> или позвоните нам по телефону <a href="tel:+78001234567" class="text-green-600 hover:underline">+7 (800) 123-45-67</a>.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Модальное окно успеха -->
  <div id="successModal" class="fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg p-8 max-w-md mx-auto text-center">
      <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-10 h-10 text-green-600 success-checkmark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
      </div>
      <h3 class="text-2xl font-bold mb-4">Покупка успешно завершена!</h3>
      <p class="mb-6">Спасибо за вашу покупку. Вы получите подтверждение на электронную почту в ближайшее время.</p>
      <div class="flex justify-center space-x-4">
        <a href="register.html" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">Перейти в Личный кабинет</a>
      </div>
    </div>
  </div>

  <!-- Боковая панель корзины -->
  <div id="cartSidebar" class="fixed inset-y-0 right-0 w-80 bg-white shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out z-40">
    <div class="h-full flex flex-col">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 class="font-bold text-lg">Ваша корзина</h3>
        <button id="closeCart" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="flex-1 overflow-y-auto p-4" id="cartItems">
        <div class="text-center text-gray-500 py-8">Ваша корзина пуста</div>
      </div>
      <div class="p-4 border-t">
        <div class="flex justify-between mb-4">
          <span class="font-bold">Итого:</span>
          <span class="font-bold" id="cartTotal">0₽</span>
        </div>
        <button id="checkoutBtn" class="w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          Перейти к оформлению
        </button>
      </div>
    </div>
  </div>

  <!-- JavaScript для переключения вкладок и обработки покупок -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Инициализация выбора дат
      flatpickr("#classDate", {
        minDate: "today",
        dateFormat: "Y-m-d",
        disable: [
          function(date) {
            // Отключаем воскресенья
            return date.getDay() === 0;
          }
        ]
      });
      
      flatpickr("#serviceDate", {
        minDate: "today",
        dateFormat: "Y-m-d",
        disable: [
          function(date) {
            // Отключаем выходные
            return date.getDay() === 0 || date.getDay() === 6;
          }
        ]
      });
      
      // Переключение вкладок
      const tabButtons = document.querySelectorAll('.tab-button');
      const purchaseSections = document.querySelectorAll('.purchase-section');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const tabName = this.getAttribute('data-tab');
          
          // Обновляем кнопки вкладок
          tabButtons.forEach(btn => btn.classList.remove('tab-active'));
          this.classList.add('tab-active');
          
          // Обновляем секции
          purchaseSections.forEach(section => section.classList.remove('active-section'));
          document.getElementById(`${tabName}-section`).classList.add('active-section');
        });
      });
      
      // Выбор временного слота
      const timeSlots = document.querySelectorAll('.time-slot');
      timeSlots.forEach(slot => {
        slot.addEventListener('click', function() {
          // Если в том же контейнере, отменяем выбор других
          const container = this.parentElement;
          container.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
      
      // Разбор параметров URL для установки значений по умолчанию
      const urlParams = new URLSearchParams(window.location.search);
      const plan = urlParams.get('plan');
      const billing = urlParams.get('billing');
      const service = urlParams.get('service');
      const option = urlParams.get('option');
      
      // Сохраняем в глобальной области для отправки формы
      window.selectedPlan = urlParams.get('plan') || 'standard';
      window.selectedBilling = urlParams.get('billing') || 'monthly';
      
      // Переключение между месячным и годовым биллингом
      const toggleSlider = document.getElementById('toggleSlider');
      const monthlyOption = document.getElementById('monthlyOption');
      const annualOption = document.getElementById('annualOption');
      const monthlyPrices = document.querySelectorAll('.monthly-prices');
      const annualPrices = document.querySelectorAll('.annual-prices');
      
      // Установка начального периода биллинга на основе URL
      if (window.selectedBilling === 'annual') {
        toggleSlider.classList.add('annual');
        monthlyOption.classList.remove('text-green-600');
        monthlyOption.classList.add('text-gray-600');
        annualOption.classList.remove('text-gray-600');
        annualOption.classList.add('text-green-600');
        
        monthlyPrices.forEach(el => el.classList.add('hidden'));
        annualPrices.forEach(el => el.classList.remove('hidden'));
      }
      
      // Обработчики переключения
      monthlyOption.addEventListener('click', () => {
        toggleBilling('monthly');
      });
      
      annualOption.addEventListener('click', () => {
        toggleBilling('annual');
      });
      
      function toggleBilling(type) {
        window.selectedBilling = type;
        
        if (type === 'annual') {
          toggleSlider.classList.add('annual');
          monthlyOption.classList.remove('text-green-600');
          monthlyOption.classList.add('text-gray-600');
          annualOption.classList.remove('text-gray-600');
          annualOption.classList.add('text-green-600');
          
          monthlyPrices.forEach(el => el.classList.add('hidden'));
          annualPrices.forEach(el => el.classList.remove('hidden'));
        } else {
          toggleSlider.classList.remove('annual');
          monthlyOption.classList.add('text-green-600');
          monthlyOption.classList.remove('text-gray-600');
          annualOption.classList.add('text-gray-600');
          annualOption.classList.remove('text-green-600');
          
          monthlyPrices.forEach(el => el.classList.remove('hidden'));
          annualPrices.forEach(el => el.classList.add('hidden'));
        }
        
        updateSummary();
      }
      
      // Выбор абонемента
      const membershipOptions = document.querySelectorAll('.membership-option');
      membershipOptions.forEach(option => {
        option.addEventListener('click', function() {
          const plan = this.getAttribute('data-plan');
          window.selectedPlan = plan;
          
          // Обновляем UI выбора
          membershipOptions.forEach(opt => {
            const radio = opt.querySelector('.membership-radio');
            if (opt.getAttribute('data-plan') === plan) {
              opt.classList.add('border-2');
              opt.classList.add(getPlanBorderColor(plan));
              opt.classList.add('shadow-md');
              radio.classList.remove('border-gray-300');
              radio.classList.add('border-' + getPlanColor(plan));
              radio.classList.add('bg-' + getPlanColor(plan));
              radio.innerHTML = '<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
            } else {
              opt.classList.remove('border-2');
              opt.classList.remove('border-blue-500', 'border-green-500', 'border-purple-500');
              opt.classList.remove('shadow-md');
              radio.classList.add('border-gray-300');
              radio.classList.remove('border-blue-500', 'border-green-500', 'border-purple-500');
              radio.classList.remove('bg-blue-500', 'bg-green-500', 'bg-purple-500');
              radio.innerHTML = '';
            }
          });
          
          updateSummary();
        });
      });
      
      // Выбор способа оплаты
      const paymentMethods = document.querySelectorAll('.payment-method');
      paymentMethods.forEach(method => {
        method.addEventListener('click', function() {
          paymentMethods.forEach(m => m.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
      
      // Обновление сводки заказа
      function updateSummary() {
        const planName = document.getElementById('summaryPlanName');
        const planPrice = document.getElementById('summaryPlanPrice');
        const subtotal = document.getElementById('summarySubtotal');
        const discount = document.getElementById('summaryDiscount');
        const total = document.getElementById('summaryTotal');
        
        let planTitle, price;
        
        switch(window.selectedPlan) {
          case 'basic':
            planTitle = 'Базовый абонемент';
            price = window.selectedBilling === 'annual' ? 2300 : 2900;
            break;
          case 'standard':
            planTitle = 'Стандартный абонемент';
            price = window.selectedBilling === 'annual' ? 3900 : 4900;
            break;
          case 'premium':
            planTitle = 'Премиум абонемент';
            price = window.selectedBilling === 'annual' ? 6300 : 7900;
            break;
          default:
            planTitle = 'Стандартный абонемент';
            price = window.selectedBilling === 'annual' ? 3900 : 4900;
        }
        
        planName.textContent = planTitle;
        planPrice.textContent = `${price}₽/${window.selectedBilling === 'annual' ? 'месяц (ежегодно)' : 'месяц'}`;
        subtotal.textContent = `${price.toFixed(0)}₽`;
        
        // Расчет скидки (для акций)
        const discountAmount = 0; // Можно изменить для акций
        discount.textContent = `-${discountAmount.toFixed(0)}₽`;
        
        const totalAmount = price - discountAmount;
        total.textContent = `${totalAmount.toFixed(0)}₽`;
      }
      
      // Вспомогательные функции
      function getPlanColor(plan) {
        switch(plan) {
          case 'basic': return 'blue-500';
          case 'standard': return 'green-500';
          case 'premium': return 'purple-500';
          default: return 'green-500';
        }
      }
      
      function getPlanBorderColor(plan) {
        switch(plan) {
          case 'basic': return 'border-blue-500';
          case 'standard': return 'border-green-500';
          case 'premium': return 'border-purple-500';
          default: return 'border-green-500';
        }
      }
      
      // Установка начального выбранного плана на основе параметра URL
      membershipOptions.forEach(option => {
        if (option.getAttribute('data-plan') === window.selectedPlan) {
          option.click();
        }
      });
      
      // Функциональность корзины покупок
      const cartButton = document.getElementById('cartButton');
      const cartSidebar = document.getElementById('cartSidebar');
      const closeCart = document.getElementById('closeCart');
      
      cartButton.addEventListener('click', function() {
        cartSidebar.classList.remove('translate-x-full');
      });
      
      closeCart.addEventListener('click', function() {
        cartSidebar.classList.add('translate-x-full');
      });
      
      // Обработка модального окна успеха
      document.getElementById('membershipForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        
        if (currentUser) {
          // Обновляем абонемент пользователя в localStorage
          currentUser.membershipType = window.selectedPlan || 'standard';
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          // Делаем API-вызов для обновления абонемента пользователя в базе данных
          try {
            const serverUrl = window.location.origin;
            fetch(`${serverUrl}/update-membership`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                userId: currentUser.id,
                membershipType: window.selectedPlan || 'standard',
                billingCycle: window.selectedBilling || 'monthly'
              })
            }).catch(error => console.warn("Не удалось обновить абонемент на сервере:", error));
            
            // Также логируем это взаимодействие
            fetch(`${serverUrl}/log-interaction`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ 
                userId: currentUser.id,
                type: 'membership_purchase',
                data: `Пользователь приобрел абонемент ${window.selectedPlan} с ${window.selectedBilling} оплатой`
              })
            }).catch(error => console.warn("Не удалось записать взаимодействие:", error));
            
          } catch (error) {
            console.warn("Ошибка обновления абонемента:", error);
          }
        } else {
          // Если пользователь не вошел в систему, перенаправляем на страницу входа
          alert('Пожалуйста, войдите в систему для покупки абонемента');
          window.location.href = 'login.html?redirect=purchase.html';
          return;
        }
        
        // Показываем модальное окно успеха, но меняем ссылку и текст
        const successModal = document.getElementById('successModal');
        const accountLink = successModal.querySelector('a');
        accountLink.textContent = 'Просмотр моего аккаунта';
        accountLink.href = 'register.html';
        successModal.classList.remove('hidden');
        
        // Сокращаем время перенаправления (2 секунды вместо 5)
        setTimeout(function() {
          document.getElementById('successModal').classList.add('hidden');
          // Перенаправляем непосредственно на страницу аккаунта с параметром, указывающим, что была совершена покупка
          window.location.href = 'register.html?purchased=true';
        }, 2000);
      });
      
      // Проверяем, вошел ли пользователь в систему при загрузке страницы
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const registerBtn = document.getElementById('registerBtn');
      const loginBtn = document.getElementById('loginBtn');
      
      if (currentUser) {
        // Обновляем UI, чтобы показать, что пользователь вошел в систему
        if (registerBtn) {
          registerBtn.textContent = currentUser.firstName;
          registerBtn.href = 'register.html';
        }
        
        if (loginBtn) {
          loginBtn.textContent = 'Выход';
          loginBtn.href = '#';
          loginBtn.addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('currentUser');
            window.location.href = 'main.html';
          });
        }
        
        // Также проверяем, нужно ли пользователю обновление - показываем уведомление
        if (currentUser.membershipType === 'none' || !currentUser.membershipType) {
          const upgradeNotice = document.getElementById('upgrade-notice');
          if (upgradeNotice) {
            upgradeNotice.classList.remove('hidden');
          }
        }
        
        // Предзаполняем поля формы данными пользователя
        document.getElementById('name').value = currentUser.firstName + ' ' + currentUser.lastName;
        document.getElementById('email').value = currentUser.email;
        document.getElementById('phone').value = currentUser.phone || '';
      } else {
        // Пользователь не вошел в систему - подчеркиваем необходимость войти
        const membershipForm = document.getElementById('membershipForm');
        if (membershipForm) {
          const loginNotice = document.createElement('div');
          loginNotice.className = 'bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6';
          loginNotice.innerHTML = `
            <div class="flex">
              <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm text-yellow-700">
                  Вам нужно <a href="login.html" class="font-bold text-yellow-700 underline">войти</a> или <a href="register.html" class="font-bold text-yellow-700 underline">создать аккаунт</a>, чтобы завершить покупку.
                </p>
              </div>
            </div>
          `;
          membershipForm.insertBefore(loginNotice, membershipForm.firstChild);
        }
      }
      
      // Инициализируем сводку заказа при загрузке страницы
      updateSummary(); 
    });
  </script>
</body>
</html>
